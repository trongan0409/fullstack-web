{"ast":null,"code":"import _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inheritsLoose from \"@babel/runtime/helpers/inheritsLoose\";\nimport * as React from 'react';\nimport Icon from '../../components/Icon';\nimport i18n from '../../i18n';\nimport { PluginComponent } from '../Plugin';\nimport LoggerPlugin from './logger';\nvar LOGGER_INTERVAL = 600;\n\nvar Logger = /*#__PURE__*/function (_PluginComponent) {\n  _inheritsLoose(Logger, _PluginComponent);\n\n  function Logger(props) {\n    var _this;\n\n    _this = _PluginComponent.call(this, props) || this;\n    _this.handleKeyboards = [];\n    _this.lastPop = null;\n    _this.handleChange = _this.handleChange.bind(_assertThisInitialized(_this));\n    _this.handleRedo = _this.handleRedo.bind(_assertThisInitialized(_this));\n    _this.handleUndo = _this.handleUndo.bind(_assertThisInitialized(_this)); // Mac的Redo比较特殊，是Command+Shift+Z，优先处理\n\n    _this.handleKeyboards = [{\n      key: 'y',\n      keyCode: 89,\n      withKey: ['ctrlKey'],\n      callback: _this.handleRedo\n    }, {\n      key: 'z',\n      keyCode: 90,\n      withKey: ['metaKey', 'shiftKey'],\n      callback: _this.handleRedo\n    }, {\n      key: 'z',\n      keyCode: 90,\n      aliasCommand: true,\n      withKey: ['ctrlKey'],\n      callback: _this.handleUndo\n    }];\n    _this.logger = new LoggerPlugin();\n    return _this;\n  }\n\n  var _proto = Logger.prototype;\n\n  _proto.handleUndo = function handleUndo() {\n    var last = this.logger.undo(this.editor.getMdValue());\n\n    if (typeof last !== 'undefined') {\n      this.pause();\n      this.lastPop = last;\n      this.editor.setText(last);\n      this.forceUpdate();\n    }\n  };\n\n  _proto.handleRedo = function handleRedo() {\n    var last = this.logger.redo();\n\n    if (typeof last !== 'undefined') {\n      this.lastPop = last;\n      this.editor.setText(last);\n      this.forceUpdate();\n    }\n  };\n\n  _proto.handleChange = function handleChange(value, e, isChange) {\n    var _this2 = this;\n\n    if (this.logger.getLast() === value || this.lastPop !== null && this.lastPop === value) {\n      return;\n    }\n\n    this.logger.cleanRedo();\n\n    if (isChange) {\n      this.logger.push(value);\n      this.lastPop = null;\n      this.forceUpdate();\n      return;\n    }\n\n    if (this.timerId) {\n      window.clearTimeout(this.timerId);\n      this.timerId = 0;\n    }\n\n    this.timerId = window.setTimeout(function () {\n      if (_this2.logger.getLast() !== value) {\n        _this2.logger.push(value);\n\n        _this2.lastPop = null;\n\n        _this2.forceUpdate();\n      }\n\n      window.clearTimeout(_this2.timerId);\n      _this2.timerId = 0;\n    }, LOGGER_INTERVAL);\n  };\n\n  _proto.componentDidMount = function componentDidMount() {\n    var _this3 = this; // 监听变化事件\n\n\n    this.editor.on('change', this.handleChange); // 监听键盘事件\n\n    this.handleKeyboards.forEach(function (it) {\n      return _this3.editor.onKeyboard(it);\n    }); // 初始化时，把已有值填充进logger\n\n    this.logger.initValue = this.editor.getMdValue();\n    this.forceUpdate();\n  };\n\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    var _this4 = this;\n\n    if (this.timerId) {\n      window.clearTimeout(this.timerId);\n    }\n\n    this.editor.off('change', this.handleChange);\n    this.handleKeyboards.forEach(function (it) {\n      return _this4.editor.offKeyboard(it);\n    });\n  };\n\n  _proto.pause = function pause() {\n    if (this.timerId) {\n      window.clearTimeout(this.timerId);\n      this.timerId = undefined;\n    }\n  };\n\n  _proto.render = function render() {\n    var hasUndo = this.logger.getUndoCount() > 1 || this.logger.initValue !== this.editor.getMdValue();\n    var hasRedo = this.logger.getRedoCount() > 0;\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"button button-type-undo \" + (hasUndo ? '' : 'disabled'),\n      title: i18n.get('btnUndo'),\n      onClick: this.handleUndo\n    }, /*#__PURE__*/React.createElement(Icon, {\n      type: \"undo\"\n    })), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"button button-type-redo \" + (hasRedo ? '' : 'disabled'),\n      title: i18n.get('btnRedo'),\n      onClick: this.handleRedo\n    }, /*#__PURE__*/React.createElement(Icon, {\n      type: \"redo\"\n    })));\n  };\n\n  return Logger;\n}(PluginComponent);\n\nLogger.pluginName = 'logger';\nexport { Logger as default };","map":{"version":3,"sources":["E:/fullstack/reactjs/node_modules/react-markdown-editor-lite/esm/plugins/logger/index.js"],"names":["_assertThisInitialized","_inheritsLoose","React","Icon","i18n","PluginComponent","LoggerPlugin","LOGGER_INTERVAL","Logger","_PluginComponent","props","_this","call","handleKeyboards","lastPop","handleChange","bind","handleRedo","handleUndo","key","keyCode","withKey","callback","aliasCommand","logger","_proto","prototype","last","undo","editor","getMdValue","pause","setText","forceUpdate","redo","value","e","isChange","_this2","getLast","cleanRedo","push","timerId","window","clearTimeout","setTimeout","componentDidMount","_this3","on","forEach","it","onKeyboard","initValue","componentWillUnmount","_this4","off","offKeyboard","undefined","render","hasUndo","getUndoCount","hasRedo","getRedoCount","createElement","Fragment","className","title","get","onClick","type","pluginName","default"],"mappings":"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","sourcesContent":["import _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inheritsLoose from \"@babel/runtime/helpers/inheritsLoose\";\nimport * as React from 'react';\nimport Icon from '../../components/Icon';\nimport i18n from '../../i18n';\nimport { PluginComponent } from '../Plugin';\nimport LoggerPlugin from './logger';\nvar LOGGER_INTERVAL = 600;\n\nvar Logger = /*#__PURE__*/function (_PluginComponent) {\n  _inheritsLoose(Logger, _PluginComponent);\n\n  function Logger(props) {\n    var _this;\n\n    _this = _PluginComponent.call(this, props) || this;\n    _this.handleKeyboards = [];\n    _this.lastPop = null;\n    _this.handleChange = _this.handleChange.bind(_assertThisInitialized(_this));\n    _this.handleRedo = _this.handleRedo.bind(_assertThisInitialized(_this));\n    _this.handleUndo = _this.handleUndo.bind(_assertThisInitialized(_this)); // Mac的Redo比较特殊，是Command+Shift+Z，优先处理\n\n    _this.handleKeyboards = [{\n      key: 'y',\n      keyCode: 89,\n      withKey: ['ctrlKey'],\n      callback: _this.handleRedo\n    }, {\n      key: 'z',\n      keyCode: 90,\n      withKey: ['metaKey', 'shiftKey'],\n      callback: _this.handleRedo\n    }, {\n      key: 'z',\n      keyCode: 90,\n      aliasCommand: true,\n      withKey: ['ctrlKey'],\n      callback: _this.handleUndo\n    }];\n    _this.logger = new LoggerPlugin();\n    return _this;\n  }\n\n  var _proto = Logger.prototype;\n\n  _proto.handleUndo = function handleUndo() {\n    var last = this.logger.undo(this.editor.getMdValue());\n\n    if (typeof last !== 'undefined') {\n      this.pause();\n      this.lastPop = last;\n      this.editor.setText(last);\n      this.forceUpdate();\n    }\n  };\n\n  _proto.handleRedo = function handleRedo() {\n    var last = this.logger.redo();\n\n    if (typeof last !== 'undefined') {\n      this.lastPop = last;\n      this.editor.setText(last);\n      this.forceUpdate();\n    }\n  };\n\n  _proto.handleChange = function handleChange(value, e, isChange) {\n    var _this2 = this;\n\n    if (this.logger.getLast() === value || this.lastPop !== null && this.lastPop === value) {\n      return;\n    }\n\n    this.logger.cleanRedo();\n\n    if (isChange) {\n      this.logger.push(value);\n      this.lastPop = null;\n      this.forceUpdate();\n      return;\n    }\n\n    if (this.timerId) {\n      window.clearTimeout(this.timerId);\n      this.timerId = 0;\n    }\n\n    this.timerId = window.setTimeout(function () {\n      if (_this2.logger.getLast() !== value) {\n        _this2.logger.push(value);\n\n        _this2.lastPop = null;\n\n        _this2.forceUpdate();\n      }\n\n      window.clearTimeout(_this2.timerId);\n      _this2.timerId = 0;\n    }, LOGGER_INTERVAL);\n  };\n\n  _proto.componentDidMount = function componentDidMount() {\n    var _this3 = this;\n\n    // 监听变化事件\n    this.editor.on('change', this.handleChange); // 监听键盘事件\n\n    this.handleKeyboards.forEach(function (it) {\n      return _this3.editor.onKeyboard(it);\n    }); // 初始化时，把已有值填充进logger\n\n    this.logger.initValue = this.editor.getMdValue();\n    this.forceUpdate();\n  };\n\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    var _this4 = this;\n\n    if (this.timerId) {\n      window.clearTimeout(this.timerId);\n    }\n\n    this.editor.off('change', this.handleChange);\n    this.handleKeyboards.forEach(function (it) {\n      return _this4.editor.offKeyboard(it);\n    });\n  };\n\n  _proto.pause = function pause() {\n    if (this.timerId) {\n      window.clearTimeout(this.timerId);\n      this.timerId = undefined;\n    }\n  };\n\n  _proto.render = function render() {\n    var hasUndo = this.logger.getUndoCount() > 1 || this.logger.initValue !== this.editor.getMdValue();\n    var hasRedo = this.logger.getRedoCount() > 0;\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"button button-type-undo \" + (hasUndo ? '' : 'disabled'),\n      title: i18n.get('btnUndo'),\n      onClick: this.handleUndo\n    }, /*#__PURE__*/React.createElement(Icon, {\n      type: \"undo\"\n    })), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"button button-type-redo \" + (hasRedo ? '' : 'disabled'),\n      title: i18n.get('btnRedo'),\n      onClick: this.handleRedo\n    }, /*#__PURE__*/React.createElement(Icon, {\n      type: \"redo\"\n    })));\n  };\n\n  return Logger;\n}(PluginComponent);\n\nLogger.pluginName = 'logger';\nexport { Logger as default };"]},"metadata":{},"sourceType":"module"}