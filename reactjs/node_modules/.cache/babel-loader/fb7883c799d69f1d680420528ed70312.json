{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inheritsLoose from \"@babel/runtime/helpers/inheritsLoose\";\n\nfunction _createForOfIteratorHelperLoose(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n  if (it) return (it = it.call(o)).next.bind(it);\n\n  if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n    if (it) o = it;\n    var i = 0;\n    return function () {\n      if (i >= o.length) return {\n        done: true\n      };\n      return {\n        done: false,\n        value: o[i++]\n      };\n    };\n  }\n\n  throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nimport * as React from 'react';\nimport Icon from '../components/Icon';\nimport NavigationBar from '../components/NavigationBar';\nimport ToolBar from '../components/ToolBar';\nimport i18n from '../i18n';\nimport DividerPlugin from '../plugins/divider';\nimport Emitter, { globalEmitter } from '../share/emitter';\nimport { initialSelection } from '../share/var';\nimport getDecorated from '../utils/decorate';\nimport mergeConfig from '../utils/mergeConfig';\nimport { getLineAndCol, isKeyMatch, isPromise } from '../utils/tool';\nimport getUploadPlaceholder from '../utils/uploadPlaceholder';\nimport defaultConfig from './defaultConfig';\nimport { HtmlRender } from './preview';\n\nvar Editor = /*#__PURE__*/function (_React$Component) {\n  _inheritsLoose(Editor, _React$Component);\n  /**\n   * Register plugin\n   * @param {any} comp Plugin component\n   * @param {any} config Other configs\n   */\n\n\n  Editor.use = function use(comp, config) {\n    if (config === void 0) {\n      config = {};\n    } // Check for duplicate plugins\n\n\n    for (var i = 0; i < Editor.plugins.length; i++) {\n      if (Editor.plugins[i].comp === comp) {\n        Editor.plugins.splice(i, 1, {\n          comp: comp,\n          config: config\n        });\n        return;\n      }\n    }\n\n    Editor.plugins.push({\n      comp: comp,\n      config: config\n    });\n  }\n  /**\n   * Unregister plugin\n   * @param {any} comp Plugin component\n   */\n  ;\n\n  Editor.unuse = function unuse(comp) {\n    for (var i = 0; i < Editor.plugins.length; i++) {\n      if (Editor.plugins[i].comp === comp) {\n        Editor.plugins.splice(i, 1);\n        return;\n      }\n    }\n  }\n  /**\n   * Unregister all plugins\n   * @param {any} comp Plugin component\n   */\n  ;\n\n  Editor.unuseAll = function unuseAll() {\n    Editor.plugins = [];\n  }\n  /**\n   * Locales\n   */\n  ;\n\n  function Editor(props) {\n    var _this;\n\n    _this = _React$Component.call(this, props) || this;\n    _this.nodeMdText = /*#__PURE__*/React.createRef();\n    _this.nodeMdPreview = /*#__PURE__*/React.createRef();\n    _this.nodeMdPreviewWrapper = /*#__PURE__*/React.createRef();\n    _this.hasContentChanged = true;\n    _this.scrollScale = 1;\n    _this.isSyncingScroll = false;\n    _this.shouldSyncScroll = 'md';\n    _this.keyboardListeners = [];\n    _this.emitter = new Emitter();\n    _this.config = mergeConfig(defaultConfig, _this.props.config, _this.props);\n    _this.state = {\n      text: (_this.props.value || _this.props.defaultValue || '').replace(/↵/g, '\\n'),\n      html: '',\n      view: _this.config.view || defaultConfig.view,\n      fullScreen: false,\n      plugins: _this.getPlugins()\n    };\n\n    if (_this.config.canView && !_this.config.canView.menu) {\n      _this.state.view.menu = false;\n    }\n\n    _this.nodeMdText = /*#__PURE__*/React.createRef();\n    _this.nodeMdPreviewWrapper = /*#__PURE__*/React.createRef();\n    _this.handleChange = _this.handleChange.bind(_assertThisInitialized(_this));\n    _this.handlePaste = _this.handlePaste.bind(_assertThisInitialized(_this));\n    _this.handleDrop = _this.handleDrop.bind(_assertThisInitialized(_this));\n    _this.handleToggleMenu = _this.handleToggleMenu.bind(_assertThisInitialized(_this));\n    _this.handleKeyDown = _this.handleKeyDown.bind(_assertThisInitialized(_this));\n    _this.handleEditorKeyDown = _this.handleEditorKeyDown.bind(_assertThisInitialized(_this));\n    _this.handleLocaleUpdate = _this.handleLocaleUpdate.bind(_assertThisInitialized(_this));\n    _this.handleFocus = _this.handleFocus.bind(_assertThisInitialized(_this));\n    _this.handleBlur = _this.handleBlur.bind(_assertThisInitialized(_this));\n    _this.handleInputScroll = _this.handleSyncScroll.bind(_assertThisInitialized(_this), 'md');\n    _this.handlePreviewScroll = _this.handleSyncScroll.bind(_assertThisInitialized(_this), 'html');\n    return _this;\n  }\n\n  var _proto = Editor.prototype;\n\n  _proto.componentDidMount = function componentDidMount() {\n    var text = this.state.text;\n    this.renderHTML(text);\n    globalEmitter.on(globalEmitter.EVENT_LANG_CHANGE, this.handleLocaleUpdate); // init i18n\n\n    i18n.setUp();\n  };\n\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    globalEmitter.off(globalEmitter.EVENT_LANG_CHANGE, this.handleLocaleUpdate);\n  };\n\n  _proto.componentDidUpdate = function componentDidUpdate(prevProps) {\n    if (typeof this.props.value !== 'undefined' && this.props.value !== this.state.text) {\n      var value = this.props.value;\n\n      if (typeof value !== 'string') {\n        value = String(value).toString();\n      }\n\n      value = value.replace(/↵/g, '\\n');\n\n      if (this.state.text !== value) {\n        this.setState({\n          text: value\n        });\n        this.renderHTML(value);\n      }\n    }\n\n    if (prevProps.plugins !== this.props.plugins) {\n      this.setState({\n        plugins: this.getPlugins()\n      });\n    }\n  };\n\n  _proto.getPlugins = function getPlugins() {\n    var _this2 = this;\n\n    var plugins = [];\n\n    if (this.props.plugins) {\n      // If plugins option is configured, use only specified plugins\n      var addToPlugins = function addToPlugins(name) {\n        if (name === DividerPlugin.pluginName) {\n          plugins.push({\n            comp: DividerPlugin,\n            config: {}\n          });\n          return;\n        }\n\n        for (var _iterator = _createForOfIteratorHelperLoose(Editor.plugins), _step; !(_step = _iterator()).done;) {\n          var it = _step.value;\n\n          if (it.comp.pluginName === name) {\n            plugins.push(it);\n            return;\n          }\n        }\n      };\n\n      for (var _iterator2 = _createForOfIteratorHelperLoose(this.props.plugins), _step2; !(_step2 = _iterator2()).done;) {\n        var name = _step2.value; // Special handling of fonts to ensure backward compatibility\n\n        if (name === 'fonts') {\n          addToPlugins('font-bold');\n          addToPlugins('font-italic');\n          addToPlugins('font-underline');\n          addToPlugins('font-strikethrough');\n          addToPlugins('list-unordered');\n          addToPlugins('list-ordered');\n          addToPlugins('block-quote');\n          addToPlugins('block-wrap');\n          addToPlugins('block-code-inline');\n          addToPlugins('block-code-block');\n        } else {\n          addToPlugins(name);\n        }\n      }\n    } else {\n      // Use all registered plugins\n      plugins = [].concat(Editor.plugins);\n    }\n\n    var result = {};\n    plugins.forEach(function (it) {\n      if (typeof result[it.comp.align] === 'undefined') {\n        result[it.comp.align] = [];\n      }\n\n      result[it.comp.align].push( /*#__PURE__*/React.createElement(it.comp, {\n        editor: _this2,\n        editorConfig: _this2.config,\n        config: _extends({}, it.comp.defaultConfig || {}, it.config || {}),\n        key: it.comp.pluginName\n      }));\n    });\n    return result;\n  } // sync left and right section's scroll\n  ;\n\n  _proto.handleSyncScroll = function handleSyncScroll(type, e) {\n    var _this3 = this; // prevent loop\n\n\n    if (type !== this.shouldSyncScroll) {\n      return;\n    } // trigger events\n\n\n    if (this.props.onScroll) {\n      this.props.onScroll(e, type);\n    }\n\n    this.emitter.emit(this.emitter.EVENT_SCROLL, e, type); // should sync scroll?\n\n    var _this$config$syncScro = this.config.syncScrollMode,\n        syncScrollMode = _this$config$syncScro === void 0 ? [] : _this$config$syncScro;\n\n    if (!syncScrollMode.includes(type === 'md' ? 'rightFollowLeft' : 'leftFollowRight')) {\n      return;\n    }\n\n    if (this.hasContentChanged && this.nodeMdText.current && this.nodeMdPreviewWrapper.current) {\n      // 计算出左右的比例\n      this.scrollScale = this.nodeMdText.current.scrollHeight / this.nodeMdPreviewWrapper.current.scrollHeight;\n      this.hasContentChanged = false;\n    }\n\n    if (!this.isSyncingScroll) {\n      this.isSyncingScroll = true;\n      requestAnimationFrame(function () {\n        if (_this3.nodeMdText.current && _this3.nodeMdPreviewWrapper.current) {\n          if (type === 'md') {\n            // left to right\n            _this3.nodeMdPreviewWrapper.current.scrollTop = _this3.nodeMdText.current.scrollTop / _this3.scrollScale;\n          } else {\n            // right to left\n            _this3.nodeMdText.current.scrollTop = _this3.nodeMdPreviewWrapper.current.scrollTop * _this3.scrollScale;\n          }\n        }\n\n        _this3.isSyncingScroll = false;\n      });\n    }\n  };\n\n  _proto.renderHTML = function renderHTML(markdownText) {\n    var _this4 = this;\n\n    if (!this.props.renderHTML) {\n      console.error('renderHTML props is required!');\n      return Promise.resolve();\n    }\n\n    var res = this.props.renderHTML(markdownText);\n\n    if (isPromise(res)) {\n      // @ts-ignore\n      return res.then(function (r) {\n        return _this4.setHtml(r);\n      });\n    }\n\n    if (typeof res === 'function') {\n      return this.setHtml(res());\n    }\n\n    return this.setHtml(res);\n  };\n\n  _proto.setHtml = function setHtml(html) {\n    var _this5 = this;\n\n    return new Promise(function (resolve) {\n      _this5.setState({\n        html: html\n      }, resolve);\n    });\n  };\n\n  _proto.handleToggleMenu = function handleToggleMenu() {\n    this.setView({\n      menu: !this.state.view.menu\n    });\n  };\n\n  _proto.handleFocus = function handleFocus(e) {\n    var onFocus = this.props.onFocus;\n\n    if (onFocus) {\n      onFocus(e);\n    }\n\n    this.emitter.emit(this.emitter.EVENT_FOCUS, e);\n  };\n\n  _proto.handleBlur = function handleBlur(e) {\n    var onBlur = this.props.onBlur;\n\n    if (onBlur) {\n      onBlur(e);\n    }\n\n    this.emitter.emit(this.emitter.EVENT_BLUR, e);\n  }\n  /**\n   * Text area change event\n   * @param {React.ChangeEvent} e\n   */\n  ;\n\n  _proto.handleChange = function handleChange(e) {\n    e.persist();\n    var value = e.target.value; // 触发内部事件\n\n    this.setText(value, e);\n  }\n  /**\n   * Listen paste event to support paste images\n   */\n  ;\n\n  _proto.handlePaste = function handlePaste(e) {\n    if (!this.config.allowPasteImage || !this.config.onImageUpload) {\n      return;\n    }\n\n    var event = e.nativeEvent; // @ts-ignore\n\n    var items = (event.clipboardData || window.clipboardData).items;\n\n    if (items) {\n      e.preventDefault();\n      this.uploadWithDataTransfer(items);\n    }\n  } // Drag images to upload\n  ;\n\n  _proto.handleDrop = function handleDrop(e) {\n    if (!this.config.onImageUpload) {\n      return;\n    }\n\n    var event = e.nativeEvent;\n\n    if (!event.dataTransfer) {\n      return;\n    }\n\n    var items = event.dataTransfer.items;\n\n    if (items) {\n      e.preventDefault();\n      this.uploadWithDataTransfer(items);\n    }\n  };\n\n  _proto.handleEditorKeyDown = function handleEditorKeyDown(e) {\n    var _this6 = this;\n\n    var keyCode = e.keyCode,\n        key = e.key,\n        currentTarget = e.currentTarget;\n\n    if (keyCode === 13 || key === 'Enter') {\n      var _text = e.currentTarget.value;\n      var curPos = currentTarget.selectionStart;\n      var lineInfo = getLineAndCol(_text, curPos);\n\n      var emptyCurrentLine = function emptyCurrentLine() {\n        var newValue = currentTarget.value.substr(0, curPos - lineInfo.curLine.length) + currentTarget.value.substr(curPos);\n\n        _this6.setText(newValue, undefined, {\n          start: curPos - lineInfo.curLine.length,\n          end: curPos - lineInfo.curLine.length\n        });\n\n        e.preventDefault();\n      };\n\n      var addSymbol = function addSymbol(symbol) {\n        _this6.insertText(\"\\n\" + symbol, false, {\n          start: symbol.length + 1,\n          end: symbol.length + 1\n        });\n\n        e.preventDefault();\n      }; // Enter key, check previous line\n\n\n      var isSymbol = lineInfo.curLine.match(/^(\\s?)([-*]) /);\n\n      if (isSymbol) {\n        if (/^(\\s?)([-*]) $/.test(lineInfo.curLine)) {\n          emptyCurrentLine();\n          return;\n        }\n\n        addSymbol(isSymbol[0]);\n        return;\n      }\n\n      var isOrderList = lineInfo.curLine.match(/^(\\s?)(\\d+)\\. /);\n\n      if (isOrderList) {\n        if (/^(\\s?)(\\d+)\\. $/.test(lineInfo.curLine)) {\n          emptyCurrentLine();\n          return;\n        }\n\n        var toInsert = \"\" + isOrderList[1] + (parseInt(isOrderList[2], 10) + 1) + \". \";\n        addSymbol(toInsert);\n      }\n    }\n  } // Handle language change\n  ;\n\n  _proto.handleLocaleUpdate = function handleLocaleUpdate() {\n    this.forceUpdate();\n  }\n  /**\n   * Get elements\n   */\n  ;\n\n  _proto.getMdElement = function getMdElement() {\n    return this.nodeMdText.current;\n  };\n\n  _proto.getHtmlElement = function getHtmlElement() {\n    return this.nodeMdPreviewWrapper.current;\n  }\n  /**\n   * Clear selected\n   */\n  ;\n\n  _proto.clearSelection = function clearSelection() {\n    if (this.nodeMdText.current) {\n      this.nodeMdText.current.setSelectionRange(0, 0, 'none');\n    }\n  }\n  /**\n   * Get selected\n   * @return {Selection}\n   */\n  ;\n\n  _proto.getSelection = function getSelection() {\n    var source = this.nodeMdText.current;\n\n    if (!source) {\n      return _extends({}, initialSelection);\n    }\n\n    var start = source.selectionStart;\n    var end = source.selectionEnd;\n    var text = (source.value || '').slice(start, end);\n    return {\n      start: start,\n      end: end,\n      text: text\n    };\n  }\n  /**\n   * Set selected\n   * @param {Selection} to\n   */\n  ;\n\n  _proto.setSelection = function setSelection(to) {\n    if (this.nodeMdText.current) {\n      this.nodeMdText.current.setSelectionRange(to.start, to.end, 'forward');\n      this.nodeMdText.current.focus();\n    }\n  }\n  /**\n   * Insert markdown text\n   * @param type\n   * @param option\n   */\n  ;\n\n  _proto.insertMarkdown = function insertMarkdown(type, option) {\n    if (option === void 0) {\n      option = {};\n    }\n\n    var curSelection = this.getSelection();\n    var decorateOption = option ? _extends({}, option) : {};\n\n    if (type === 'image') {\n      decorateOption = _extends({}, decorateOption, {\n        target: option.target || curSelection.text || '',\n        imageUrl: option.imageUrl || this.config.imageUrl\n      });\n    }\n\n    if (type === 'link') {\n      decorateOption = _extends({}, decorateOption, {\n        linkUrl: this.config.linkUrl\n      });\n    }\n\n    if (type === 'tab' && curSelection.start !== curSelection.end) {\n      var curLineStart = this.getMdValue().slice(0, curSelection.start).lastIndexOf('\\n') + 1;\n      this.setSelection({\n        start: curLineStart,\n        end: curSelection.end\n      });\n    }\n\n    var decorate = getDecorated(curSelection.text, type, decorateOption);\n    var text = decorate.text;\n    var selection = decorate.selection;\n\n    if (decorate.newBlock) {\n      var startLineInfo = getLineAndCol(this.getMdValue(), curSelection.start);\n      var col = startLineInfo.col,\n          curLine = startLineInfo.curLine;\n\n      if (col > 0 && curLine.length > 0) {\n        text = \"\\n\" + text;\n\n        if (selection) {\n          selection.start++;\n          selection.end++;\n        }\n      }\n\n      var afterText = startLineInfo.afterText;\n\n      if (curSelection.start !== curSelection.end) {\n        afterText = getLineAndCol(this.getMdValue(), curSelection.end).afterText;\n      }\n\n      if (afterText.trim() !== '' && afterText.substr(0, 2) !== '\\n\\n') {\n        if (afterText.substr(0, 1) !== '\\n') {\n          text += '\\n';\n        }\n\n        text += '\\n';\n      }\n    }\n\n    this.insertText(text, true, selection);\n  }\n  /**\n   * Insert a placeholder, and replace it when the Promise resolved\n   * @param placeholder\n   * @param wait\n   */\n  ;\n\n  _proto.insertPlaceholder = function insertPlaceholder(placeholder, wait) {\n    var _this7 = this;\n\n    this.insertText(placeholder, true);\n    wait.then(function (str) {\n      var text = _this7.getMdValue().replace(placeholder, str);\n\n      _this7.setText(text);\n    });\n  }\n  /**\n   * Insert text\n   * @param {string} value The text will be insert\n   * @param {boolean} replaceSelected Replace selected text\n   * @param {Selection} newSelection New selection\n   */\n  ;\n\n  _proto.insertText = function insertText(value, replaceSelected, newSelection) {\n    if (value === void 0) {\n      value = '';\n    }\n\n    if (replaceSelected === void 0) {\n      replaceSelected = false;\n    }\n\n    var text = this.state.text;\n    var selection = this.getSelection();\n    var beforeContent = text.slice(0, selection.start);\n    var afterContent = text.slice(replaceSelected ? selection.end : selection.start, text.length);\n    this.setText(beforeContent + value + afterContent, undefined, newSelection ? {\n      start: newSelection.start + beforeContent.length,\n      end: newSelection.end + beforeContent.length\n    } : {\n      start: selection.start,\n      end: selection.start\n    });\n  }\n  /**\n   * Set text, and trigger onChange event\n   * @param {string} value\n   * @param {any} event\n   */\n  ;\n\n  _proto.setText = function setText(value, event, newSelection) {\n    var _this8 = this;\n\n    if (value === void 0) {\n      value = '';\n    }\n\n    var _this$config$onChange = this.config.onChangeTrigger,\n        onChangeTrigger = _this$config$onChange === void 0 ? 'both' : _this$config$onChange;\n    var text = value.replace(/↵/g, '\\n');\n\n    if (this.state.text === value) {\n      return;\n    }\n\n    this.setState({\n      text: text\n    });\n\n    if (this.props.onChange && (onChangeTrigger === 'both' || onChangeTrigger === 'beforeRender')) {\n      this.props.onChange({\n        text: text,\n        html: this.getHtmlValue()\n      }, event);\n    }\n\n    this.emitter.emit(this.emitter.EVENT_CHANGE, value, event, typeof event === 'undefined');\n\n    if (newSelection) {\n      setTimeout(function () {\n        return _this8.setSelection(newSelection);\n      });\n    }\n\n    if (!this.hasContentChanged) {\n      this.hasContentChanged = true;\n    }\n\n    var rendering = this.renderHTML(text);\n\n    if (onChangeTrigger === 'both' || onChangeTrigger === 'afterRender') {\n      rendering.then(function () {\n        if (_this8.props.onChange) {\n          _this8.props.onChange({\n            text: _this8.state.text,\n            html: _this8.getHtmlValue()\n          }, event);\n        }\n      });\n    }\n  }\n  /**\n   * Get text value\n   * @return {string}\n   */\n  ;\n\n  _proto.getMdValue = function getMdValue() {\n    return this.state.text;\n  }\n  /**\n   * Get rendered html\n   * @returns {string}\n   */\n  ;\n\n  _proto.getHtmlValue = function getHtmlValue() {\n    if (typeof this.state.html === 'string') {\n      return this.state.html;\n    }\n\n    if (this.nodeMdPreview.current) {\n      return this.nodeMdPreview.current.getHtml();\n    }\n\n    return '';\n  }\n  /**\n   * Listen keyboard events\n   */\n  ;\n  /**\n   * Listen keyboard events\n   * @param {KeyboardEventListener} data\n   */\n\n\n  _proto.onKeyboard = function onKeyboard(data) {\n    var _this9 = this;\n\n    if (Array.isArray(data)) {\n      data.forEach(function (it) {\n        return _this9.onKeyboard(it);\n      });\n      return;\n    }\n\n    if (!this.keyboardListeners.includes(data)) {\n      this.keyboardListeners.push(data);\n    }\n  }\n  /**\n   * Unlisten keyboard events\n   * @param {KeyboardEventListener} data\n   */\n  ;\n\n  _proto.offKeyboard = function offKeyboard(data) {\n    var _this10 = this;\n\n    if (Array.isArray(data)) {\n      data.forEach(function (it) {\n        return _this10.offKeyboard(it);\n      });\n      return;\n    }\n\n    var index = this.keyboardListeners.indexOf(data);\n\n    if (index >= 0) {\n      this.keyboardListeners.splice(index, 1);\n    }\n  };\n\n  _proto.handleKeyDown = function handleKeyDown(e) {\n    // 遍历监听数组，找找有没有被监听\n    for (var _iterator3 = _createForOfIteratorHelperLoose(this.keyboardListeners), _step3; !(_step3 = _iterator3()).done;) {\n      var it = _step3.value;\n\n      if (isKeyMatch(e, it)) {\n        e.preventDefault();\n        it.callback(e);\n        return;\n      }\n    } // 如果没有，触发默认事件\n\n\n    this.emitter.emit(this.emitter.EVENT_KEY_DOWN, e);\n  };\n\n  _proto.getEventType = function getEventType(event) {\n    switch (event) {\n      case 'change':\n        return this.emitter.EVENT_CHANGE;\n\n      case 'fullscreen':\n        return this.emitter.EVENT_FULL_SCREEN;\n\n      case 'viewchange':\n        return this.emitter.EVENT_VIEW_CHANGE;\n\n      case 'keydown':\n        return this.emitter.EVENT_KEY_DOWN;\n\n      case 'blur':\n        return this.emitter.EVENT_BLUR;\n\n      case 'focus':\n        return this.emitter.EVENT_FOCUS;\n\n      case 'scroll':\n        return this.emitter.EVENT_SCROLL;\n    }\n  }\n  /**\n   * Listen events\n   * @param {EditorEvent} event Event type\n   * @param {any} cb Callback\n   */\n  ;\n\n  _proto.on = function on(event, cb) {\n    var eventType = this.getEventType(event);\n\n    if (eventType) {\n      this.emitter.on(eventType, cb);\n    }\n  }\n  /**\n   * Unlisten events\n   * @param {EditorEvent} event Event type\n   * @param {any} cb Callback\n   */\n  ;\n\n  _proto.off = function off(event, cb) {\n    var eventType = this.getEventType(event);\n\n    if (eventType) {\n      this.emitter.off(eventType, cb);\n    }\n  }\n  /**\n   * Set view property\n   * Can show or hide: editor, preview, menu\n   * @param {object} to\n   */\n  ;\n\n  _proto.setView = function setView(to) {\n    var _this11 = this;\n\n    var newView = _extends({}, this.state.view, to);\n\n    this.setState({\n      view: newView\n    }, function () {\n      _this11.emitter.emit(_this11.emitter.EVENT_VIEW_CHANGE, newView);\n    });\n  }\n  /**\n   * Get view property\n   * @return {object}\n   */\n  ;\n\n  _proto.getView = function getView() {\n    return _extends({}, this.state.view);\n  }\n  /**\n   * Enter or exit full screen\n   * @param {boolean} enable\n   */\n  ;\n\n  _proto.fullScreen = function fullScreen(enable) {\n    var _this12 = this;\n\n    if (this.state.fullScreen !== enable) {\n      this.setState({\n        fullScreen: enable\n      }, function () {\n        _this12.emitter.emit(_this12.emitter.EVENT_FULL_SCREEN, enable);\n      });\n    }\n  }\n  /**\n   * Is full screen\n   * @return {boolean}\n   */\n  ;\n\n  _proto.isFullScreen = function isFullScreen() {\n    return this.state.fullScreen;\n  };\n\n  _proto.uploadWithDataTransfer = function uploadWithDataTransfer(items) {\n    var _this13 = this;\n\n    var onImageUpload = this.config.onImageUpload;\n\n    if (!onImageUpload) {\n      return;\n    }\n\n    var queue = [];\n    Array.prototype.forEach.call(items, function (it) {\n      if (it.kind === 'file' && it.type.includes('image')) {\n        var file = it.getAsFile();\n\n        if (file) {\n          var placeholder = getUploadPlaceholder(file, onImageUpload);\n          queue.push(Promise.resolve(placeholder.placeholder));\n          placeholder.uploaded.then(function (str) {\n            var text = _this13.getMdValue().replace(placeholder.placeholder, str);\n\n            var offset = str.length - placeholder.placeholder.length; // 计算出替换后的光标位置\n\n            var selection = _this13.getSelection();\n\n            _this13.setText(text, undefined, {\n              start: selection.start + offset,\n              end: selection.start + offset\n            });\n          });\n        }\n      } else if (it.kind === 'string' && it.type === 'text/plain') {\n        queue.push(new Promise(function (resolve) {\n          return it.getAsString(resolve);\n        }));\n      }\n    });\n    Promise.all(queue).then(function (res) {\n      var text = res.join('');\n\n      var selection = _this13.getSelection();\n\n      _this13.insertText(text, true, {\n        start: selection.start === selection.end ? text.length : 0,\n        end: text.length\n      });\n    });\n  };\n\n  _proto.render = function render() {\n    var _this14 = this;\n\n    var showHideMenu = this.config.canView && this.config.canView.hideMenu && !this.config.canView.menu;\n    var _this$state = this.state,\n        view = _this$state.view,\n        fullScreen = _this$state.fullScreen;\n\n    var getPluginAt = function getPluginAt(at) {\n      return _this14.state.plugins[at] || [];\n    };\n\n    var isShowMenu = !!view.menu;\n    var id = this.props.id;\n    var editorId = id ? id + \"_md\" : undefined;\n    var previewerId = id ? id + \"_html\" : undefined;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      id: id,\n      className: \"rc-md-editor \" + (fullScreen ? 'full' : ''),\n      style: this.props.style,\n      onKeyDown: this.handleKeyDown,\n      onDrop: this.handleDrop\n    }, /*#__PURE__*/React.createElement(NavigationBar, {\n      visible: isShowMenu,\n      left: getPluginAt('left'),\n      right: getPluginAt('right')\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"editor-container\"\n    }, showHideMenu && /*#__PURE__*/React.createElement(ToolBar, null, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"button button-type-menu\",\n      title: isShowMenu ? 'hidden menu' : 'show menu',\n      onClick: this.handleToggleMenu\n    }, /*#__PURE__*/React.createElement(Icon, {\n      type: \"expand-\" + (isShowMenu ? 'less' : 'more')\n    }))), /*#__PURE__*/React.createElement(\"section\", {\n      className: \"section sec-md \" + (view.md ? 'visible' : 'in-visible')\n    }, /*#__PURE__*/React.createElement(\"textarea\", {\n      id: editorId,\n      ref: this.nodeMdText,\n      name: this.props.name || 'textarea',\n      autoFocus: this.props.autoFocus,\n      placeholder: this.props.placeholder,\n      readOnly: this.props.readOnly,\n      value: this.state.text,\n      className: \"section-container input \" + (this.config.markdownClass || ''),\n      wrap: \"hard\",\n      onChange: this.handleChange,\n      onScroll: this.handleInputScroll,\n      onMouseOver: function onMouseOver() {\n        return _this14.shouldSyncScroll = 'md';\n      },\n      onKeyDown: this.handleEditorKeyDown,\n      onPaste: this.handlePaste,\n      onFocus: this.handleFocus,\n      onBlur: this.handleBlur\n    })), /*#__PURE__*/React.createElement(\"section\", {\n      className: \"section sec-html \" + (view.html ? 'visible' : 'in-visible')\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      id: previewerId,\n      className: \"section-container html-wrap\",\n      ref: this.nodeMdPreviewWrapper,\n      onMouseOver: function onMouseOver() {\n        return _this14.shouldSyncScroll = 'html';\n      },\n      onScroll: this.handlePreviewScroll\n    }, /*#__PURE__*/React.createElement(HtmlRender, {\n      html: this.state.html,\n      className: this.config.htmlClass,\n      ref: this.nodeMdPreview\n    })))));\n  };\n\n  return Editor;\n}(React.Component);\n\nEditor.plugins = [];\nEditor.addLocale = i18n.add.bind(i18n);\nEditor.useLocale = i18n.setCurrent.bind(i18n);\nEditor.getLocale = i18n.getCurrent.bind(i18n);\nexport default Editor;","map":{"version":3,"sources":["E:/fullstack/reactjs/node_modules/react-markdown-editor-lite/esm/editor/index.js"],"names":["_extends","_assertThisInitialized","_inheritsLoose","_createForOfIteratorHelperLoose","o","allowArrayLike","it","Symbol","iterator","call","next","bind","Array","isArray","_unsupportedIterableToArray","length","i","done","value","TypeError","minLen","_arrayLikeToArray","n","Object","prototype","toString","slice","constructor","name","from","test","arr","len","arr2","React","Icon","NavigationBar","ToolBar","i18n","DividerPlugin","Emitter","globalEmitter","initialSelection","getDecorated","mergeConfig","getLineAndCol","isKeyMatch","isPromise","getUploadPlaceholder","defaultConfig","HtmlRender","Editor","_React$Component","use","comp","config","plugins","splice","push","unuse","unuseAll","props","_this","nodeMdText","createRef","nodeMdPreview","nodeMdPreviewWrapper","hasContentChanged","scrollScale","isSyncingScroll","shouldSyncScroll","keyboardListeners","emitter","state","text","defaultValue","replace","html","view","fullScreen","getPlugins","canView","menu","handleChange","handlePaste","handleDrop","handleToggleMenu","handleKeyDown","handleEditorKeyDown","handleLocaleUpdate","handleFocus","handleBlur","handleInputScroll","handleSyncScroll","handlePreviewScroll","_proto","componentDidMount","renderHTML","on","EVENT_LANG_CHANGE","setUp","componentWillUnmount","off","componentDidUpdate","prevProps","String","setState","_this2","addToPlugins","pluginName","_iterator","_step","_iterator2","_step2","concat","result","forEach","align","createElement","editor","editorConfig","key","type","e","_this3","onScroll","emit","EVENT_SCROLL","_this$config$syncScro","syncScrollMode","includes","current","scrollHeight","requestAnimationFrame","scrollTop","markdownText","_this4","console","error","Promise","resolve","res","then","r","setHtml","_this5","setView","onFocus","EVENT_FOCUS","onBlur","EVENT_BLUR","persist","target","setText","allowPasteImage","onImageUpload","event","nativeEvent","items","clipboardData","window","preventDefault","uploadWithDataTransfer","dataTransfer","_this6","keyCode","currentTarget","_text","curPos","selectionStart","lineInfo","emptyCurrentLine","newValue","substr","curLine","undefined","start","end","addSymbol","symbol","insertText","isSymbol","match","isOrderList","toInsert","parseInt","forceUpdate","getMdElement","getHtmlElement","clearSelection","setSelectionRange","getSelection","source","selectionEnd","setSelection","to","focus","insertMarkdown","option","curSelection","decorateOption","imageUrl","linkUrl","curLineStart","getMdValue","lastIndexOf","decorate","selection","newBlock","startLineInfo","col","afterText","trim","insertPlaceholder","placeholder","wait","_this7","str","replaceSelected","newSelection","beforeContent","afterContent","_this8","_this$config$onChange","onChangeTrigger","onChange","getHtmlValue","EVENT_CHANGE","setTimeout","rendering","getHtml","onKeyboard","data","_this9","offKeyboard","_this10","index","indexOf","_iterator3","_step3","callback","EVENT_KEY_DOWN","getEventType","EVENT_FULL_SCREEN","EVENT_VIEW_CHANGE","cb","eventType","_this11","newView","getView","enable","_this12","isFullScreen","_this13","queue","kind","file","getAsFile","uploaded","offset","getAsString","all","join","render","_this14","showHideMenu","hideMenu","_this$state","getPluginAt","at","isShowMenu","id","editorId","previewerId","className","style","onKeyDown","onDrop","visible","left","right","title","onClick","md","ref","autoFocus","readOnly","markdownClass","wrap","onMouseOver","onPaste","htmlClass","Component","addLocale","add","useLocale","setCurrent","getLocale","getCurrent"],"mappings":"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","sourcesContent":["import _extends from \"@babel/runtime/helpers/extends\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inheritsLoose from \"@babel/runtime/helpers/inheritsLoose\";\n\nfunction _createForOfIteratorHelperLoose(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (it) return (it = it.call(o)).next.bind(it); if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; return function () { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nimport * as React from 'react';\nimport Icon from '../components/Icon';\nimport NavigationBar from '../components/NavigationBar';\nimport ToolBar from '../components/ToolBar';\nimport i18n from '../i18n';\nimport DividerPlugin from '../plugins/divider';\nimport Emitter, { globalEmitter } from '../share/emitter';\nimport { initialSelection } from '../share/var';\nimport getDecorated from '../utils/decorate';\nimport mergeConfig from '../utils/mergeConfig';\nimport { getLineAndCol, isKeyMatch, isPromise } from '../utils/tool';\nimport getUploadPlaceholder from '../utils/uploadPlaceholder';\nimport defaultConfig from './defaultConfig';\nimport { HtmlRender } from './preview';\n\nvar Editor = /*#__PURE__*/function (_React$Component) {\n  _inheritsLoose(Editor, _React$Component);\n\n  /**\n   * Register plugin\n   * @param {any} comp Plugin component\n   * @param {any} config Other configs\n   */\n  Editor.use = function use(comp, config) {\n    if (config === void 0) {\n      config = {};\n    }\n\n    // Check for duplicate plugins\n    for (var i = 0; i < Editor.plugins.length; i++) {\n      if (Editor.plugins[i].comp === comp) {\n        Editor.plugins.splice(i, 1, {\n          comp: comp,\n          config: config\n        });\n        return;\n      }\n    }\n\n    Editor.plugins.push({\n      comp: comp,\n      config: config\n    });\n  }\n  /**\n   * Unregister plugin\n   * @param {any} comp Plugin component\n   */\n  ;\n\n  Editor.unuse = function unuse(comp) {\n    for (var i = 0; i < Editor.plugins.length; i++) {\n      if (Editor.plugins[i].comp === comp) {\n        Editor.plugins.splice(i, 1);\n        return;\n      }\n    }\n  }\n  /**\n   * Unregister all plugins\n   * @param {any} comp Plugin component\n   */\n  ;\n\n  Editor.unuseAll = function unuseAll() {\n    Editor.plugins = [];\n  }\n  /**\n   * Locales\n   */\n  ;\n\n  function Editor(props) {\n    var _this;\n\n    _this = _React$Component.call(this, props) || this;\n    _this.nodeMdText = /*#__PURE__*/React.createRef();\n    _this.nodeMdPreview = /*#__PURE__*/React.createRef();\n    _this.nodeMdPreviewWrapper = /*#__PURE__*/React.createRef();\n    _this.hasContentChanged = true;\n    _this.scrollScale = 1;\n    _this.isSyncingScroll = false;\n    _this.shouldSyncScroll = 'md';\n    _this.keyboardListeners = [];\n    _this.emitter = new Emitter();\n    _this.config = mergeConfig(defaultConfig, _this.props.config, _this.props);\n    _this.state = {\n      text: (_this.props.value || _this.props.defaultValue || '').replace(/↵/g, '\\n'),\n      html: '',\n      view: _this.config.view || defaultConfig.view,\n      fullScreen: false,\n      plugins: _this.getPlugins()\n    };\n\n    if (_this.config.canView && !_this.config.canView.menu) {\n      _this.state.view.menu = false;\n    }\n\n    _this.nodeMdText = /*#__PURE__*/React.createRef();\n    _this.nodeMdPreviewWrapper = /*#__PURE__*/React.createRef();\n    _this.handleChange = _this.handleChange.bind(_assertThisInitialized(_this));\n    _this.handlePaste = _this.handlePaste.bind(_assertThisInitialized(_this));\n    _this.handleDrop = _this.handleDrop.bind(_assertThisInitialized(_this));\n    _this.handleToggleMenu = _this.handleToggleMenu.bind(_assertThisInitialized(_this));\n    _this.handleKeyDown = _this.handleKeyDown.bind(_assertThisInitialized(_this));\n    _this.handleEditorKeyDown = _this.handleEditorKeyDown.bind(_assertThisInitialized(_this));\n    _this.handleLocaleUpdate = _this.handleLocaleUpdate.bind(_assertThisInitialized(_this));\n    _this.handleFocus = _this.handleFocus.bind(_assertThisInitialized(_this));\n    _this.handleBlur = _this.handleBlur.bind(_assertThisInitialized(_this));\n    _this.handleInputScroll = _this.handleSyncScroll.bind(_assertThisInitialized(_this), 'md');\n    _this.handlePreviewScroll = _this.handleSyncScroll.bind(_assertThisInitialized(_this), 'html');\n    return _this;\n  }\n\n  var _proto = Editor.prototype;\n\n  _proto.componentDidMount = function componentDidMount() {\n    var text = this.state.text;\n    this.renderHTML(text);\n    globalEmitter.on(globalEmitter.EVENT_LANG_CHANGE, this.handleLocaleUpdate); // init i18n\n\n    i18n.setUp();\n  };\n\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    globalEmitter.off(globalEmitter.EVENT_LANG_CHANGE, this.handleLocaleUpdate);\n  };\n\n  _proto.componentDidUpdate = function componentDidUpdate(prevProps) {\n    if (typeof this.props.value !== 'undefined' && this.props.value !== this.state.text) {\n      var value = this.props.value;\n\n      if (typeof value !== 'string') {\n        value = String(value).toString();\n      }\n\n      value = value.replace(/↵/g, '\\n');\n\n      if (this.state.text !== value) {\n        this.setState({\n          text: value\n        });\n        this.renderHTML(value);\n      }\n    }\n\n    if (prevProps.plugins !== this.props.plugins) {\n      this.setState({\n        plugins: this.getPlugins()\n      });\n    }\n  };\n\n  _proto.getPlugins = function getPlugins() {\n    var _this2 = this;\n\n    var plugins = [];\n\n    if (this.props.plugins) {\n      // If plugins option is configured, use only specified plugins\n      var addToPlugins = function addToPlugins(name) {\n        if (name === DividerPlugin.pluginName) {\n          plugins.push({\n            comp: DividerPlugin,\n            config: {}\n          });\n          return;\n        }\n\n        for (var _iterator = _createForOfIteratorHelperLoose(Editor.plugins), _step; !(_step = _iterator()).done;) {\n          var it = _step.value;\n\n          if (it.comp.pluginName === name) {\n            plugins.push(it);\n            return;\n          }\n        }\n      };\n\n      for (var _iterator2 = _createForOfIteratorHelperLoose(this.props.plugins), _step2; !(_step2 = _iterator2()).done;) {\n        var name = _step2.value;\n\n        // Special handling of fonts to ensure backward compatibility\n        if (name === 'fonts') {\n          addToPlugins('font-bold');\n          addToPlugins('font-italic');\n          addToPlugins('font-underline');\n          addToPlugins('font-strikethrough');\n          addToPlugins('list-unordered');\n          addToPlugins('list-ordered');\n          addToPlugins('block-quote');\n          addToPlugins('block-wrap');\n          addToPlugins('block-code-inline');\n          addToPlugins('block-code-block');\n        } else {\n          addToPlugins(name);\n        }\n      }\n    } else {\n      // Use all registered plugins\n      plugins = [].concat(Editor.plugins);\n    }\n\n    var result = {};\n    plugins.forEach(function (it) {\n      if (typeof result[it.comp.align] === 'undefined') {\n        result[it.comp.align] = [];\n      }\n\n      result[it.comp.align].push( /*#__PURE__*/React.createElement(it.comp, {\n        editor: _this2,\n        editorConfig: _this2.config,\n        config: _extends({}, it.comp.defaultConfig || {}, it.config || {}),\n        key: it.comp.pluginName\n      }));\n    });\n    return result;\n  } // sync left and right section's scroll\n  ;\n\n  _proto.handleSyncScroll = function handleSyncScroll(type, e) {\n    var _this3 = this;\n\n    // prevent loop\n    if (type !== this.shouldSyncScroll) {\n      return;\n    } // trigger events\n\n\n    if (this.props.onScroll) {\n      this.props.onScroll(e, type);\n    }\n\n    this.emitter.emit(this.emitter.EVENT_SCROLL, e, type); // should sync scroll?\n\n    var _this$config$syncScro = this.config.syncScrollMode,\n        syncScrollMode = _this$config$syncScro === void 0 ? [] : _this$config$syncScro;\n\n    if (!syncScrollMode.includes(type === 'md' ? 'rightFollowLeft' : 'leftFollowRight')) {\n      return;\n    }\n\n    if (this.hasContentChanged && this.nodeMdText.current && this.nodeMdPreviewWrapper.current) {\n      // 计算出左右的比例\n      this.scrollScale = this.nodeMdText.current.scrollHeight / this.nodeMdPreviewWrapper.current.scrollHeight;\n      this.hasContentChanged = false;\n    }\n\n    if (!this.isSyncingScroll) {\n      this.isSyncingScroll = true;\n      requestAnimationFrame(function () {\n        if (_this3.nodeMdText.current && _this3.nodeMdPreviewWrapper.current) {\n          if (type === 'md') {\n            // left to right\n            _this3.nodeMdPreviewWrapper.current.scrollTop = _this3.nodeMdText.current.scrollTop / _this3.scrollScale;\n          } else {\n            // right to left\n            _this3.nodeMdText.current.scrollTop = _this3.nodeMdPreviewWrapper.current.scrollTop * _this3.scrollScale;\n          }\n        }\n\n        _this3.isSyncingScroll = false;\n      });\n    }\n  };\n\n  _proto.renderHTML = function renderHTML(markdownText) {\n    var _this4 = this;\n\n    if (!this.props.renderHTML) {\n      console.error('renderHTML props is required!');\n      return Promise.resolve();\n    }\n\n    var res = this.props.renderHTML(markdownText);\n\n    if (isPromise(res)) {\n      // @ts-ignore\n      return res.then(function (r) {\n        return _this4.setHtml(r);\n      });\n    }\n\n    if (typeof res === 'function') {\n      return this.setHtml(res());\n    }\n\n    return this.setHtml(res);\n  };\n\n  _proto.setHtml = function setHtml(html) {\n    var _this5 = this;\n\n    return new Promise(function (resolve) {\n      _this5.setState({\n        html: html\n      }, resolve);\n    });\n  };\n\n  _proto.handleToggleMenu = function handleToggleMenu() {\n    this.setView({\n      menu: !this.state.view.menu\n    });\n  };\n\n  _proto.handleFocus = function handleFocus(e) {\n    var onFocus = this.props.onFocus;\n\n    if (onFocus) {\n      onFocus(e);\n    }\n\n    this.emitter.emit(this.emitter.EVENT_FOCUS, e);\n  };\n\n  _proto.handleBlur = function handleBlur(e) {\n    var onBlur = this.props.onBlur;\n\n    if (onBlur) {\n      onBlur(e);\n    }\n\n    this.emitter.emit(this.emitter.EVENT_BLUR, e);\n  }\n  /**\n   * Text area change event\n   * @param {React.ChangeEvent} e\n   */\n  ;\n\n  _proto.handleChange = function handleChange(e) {\n    e.persist();\n    var value = e.target.value; // 触发内部事件\n\n    this.setText(value, e);\n  }\n  /**\n   * Listen paste event to support paste images\n   */\n  ;\n\n  _proto.handlePaste = function handlePaste(e) {\n    if (!this.config.allowPasteImage || !this.config.onImageUpload) {\n      return;\n    }\n\n    var event = e.nativeEvent; // @ts-ignore\n\n    var items = (event.clipboardData || window.clipboardData).items;\n\n    if (items) {\n      e.preventDefault();\n      this.uploadWithDataTransfer(items);\n    }\n  } // Drag images to upload\n  ;\n\n  _proto.handleDrop = function handleDrop(e) {\n    if (!this.config.onImageUpload) {\n      return;\n    }\n\n    var event = e.nativeEvent;\n\n    if (!event.dataTransfer) {\n      return;\n    }\n\n    var items = event.dataTransfer.items;\n\n    if (items) {\n      e.preventDefault();\n      this.uploadWithDataTransfer(items);\n    }\n  };\n\n  _proto.handleEditorKeyDown = function handleEditorKeyDown(e) {\n    var _this6 = this;\n\n    var keyCode = e.keyCode,\n        key = e.key,\n        currentTarget = e.currentTarget;\n\n    if (keyCode === 13 || key === 'Enter') {\n      var _text = e.currentTarget.value;\n      var curPos = currentTarget.selectionStart;\n      var lineInfo = getLineAndCol(_text, curPos);\n\n      var emptyCurrentLine = function emptyCurrentLine() {\n        var newValue = currentTarget.value.substr(0, curPos - lineInfo.curLine.length) + currentTarget.value.substr(curPos);\n\n        _this6.setText(newValue, undefined, {\n          start: curPos - lineInfo.curLine.length,\n          end: curPos - lineInfo.curLine.length\n        });\n\n        e.preventDefault();\n      };\n\n      var addSymbol = function addSymbol(symbol) {\n        _this6.insertText(\"\\n\" + symbol, false, {\n          start: symbol.length + 1,\n          end: symbol.length + 1\n        });\n\n        e.preventDefault();\n      }; // Enter key, check previous line\n\n\n      var isSymbol = lineInfo.curLine.match(/^(\\s?)([-*]) /);\n\n      if (isSymbol) {\n        if (/^(\\s?)([-*]) $/.test(lineInfo.curLine)) {\n          emptyCurrentLine();\n          return;\n        }\n\n        addSymbol(isSymbol[0]);\n        return;\n      }\n\n      var isOrderList = lineInfo.curLine.match(/^(\\s?)(\\d+)\\. /);\n\n      if (isOrderList) {\n        if (/^(\\s?)(\\d+)\\. $/.test(lineInfo.curLine)) {\n          emptyCurrentLine();\n          return;\n        }\n\n        var toInsert = \"\" + isOrderList[1] + (parseInt(isOrderList[2], 10) + 1) + \". \";\n        addSymbol(toInsert);\n      }\n    }\n  } // Handle language change\n  ;\n\n  _proto.handleLocaleUpdate = function handleLocaleUpdate() {\n    this.forceUpdate();\n  }\n  /**\n   * Get elements\n   */\n  ;\n\n  _proto.getMdElement = function getMdElement() {\n    return this.nodeMdText.current;\n  };\n\n  _proto.getHtmlElement = function getHtmlElement() {\n    return this.nodeMdPreviewWrapper.current;\n  }\n  /**\n   * Clear selected\n   */\n  ;\n\n  _proto.clearSelection = function clearSelection() {\n    if (this.nodeMdText.current) {\n      this.nodeMdText.current.setSelectionRange(0, 0, 'none');\n    }\n  }\n  /**\n   * Get selected\n   * @return {Selection}\n   */\n  ;\n\n  _proto.getSelection = function getSelection() {\n    var source = this.nodeMdText.current;\n\n    if (!source) {\n      return _extends({}, initialSelection);\n    }\n\n    var start = source.selectionStart;\n    var end = source.selectionEnd;\n    var text = (source.value || '').slice(start, end);\n    return {\n      start: start,\n      end: end,\n      text: text\n    };\n  }\n  /**\n   * Set selected\n   * @param {Selection} to\n   */\n  ;\n\n  _proto.setSelection = function setSelection(to) {\n    if (this.nodeMdText.current) {\n      this.nodeMdText.current.setSelectionRange(to.start, to.end, 'forward');\n      this.nodeMdText.current.focus();\n    }\n  }\n  /**\n   * Insert markdown text\n   * @param type\n   * @param option\n   */\n  ;\n\n  _proto.insertMarkdown = function insertMarkdown(type, option) {\n    if (option === void 0) {\n      option = {};\n    }\n\n    var curSelection = this.getSelection();\n    var decorateOption = option ? _extends({}, option) : {};\n\n    if (type === 'image') {\n      decorateOption = _extends({}, decorateOption, {\n        target: option.target || curSelection.text || '',\n        imageUrl: option.imageUrl || this.config.imageUrl\n      });\n    }\n\n    if (type === 'link') {\n      decorateOption = _extends({}, decorateOption, {\n        linkUrl: this.config.linkUrl\n      });\n    }\n\n    if (type === 'tab' && curSelection.start !== curSelection.end) {\n      var curLineStart = this.getMdValue().slice(0, curSelection.start).lastIndexOf('\\n') + 1;\n      this.setSelection({\n        start: curLineStart,\n        end: curSelection.end\n      });\n    }\n\n    var decorate = getDecorated(curSelection.text, type, decorateOption);\n    var text = decorate.text;\n    var selection = decorate.selection;\n\n    if (decorate.newBlock) {\n      var startLineInfo = getLineAndCol(this.getMdValue(), curSelection.start);\n      var col = startLineInfo.col,\n          curLine = startLineInfo.curLine;\n\n      if (col > 0 && curLine.length > 0) {\n        text = \"\\n\" + text;\n\n        if (selection) {\n          selection.start++;\n          selection.end++;\n        }\n      }\n\n      var afterText = startLineInfo.afterText;\n\n      if (curSelection.start !== curSelection.end) {\n        afterText = getLineAndCol(this.getMdValue(), curSelection.end).afterText;\n      }\n\n      if (afterText.trim() !== '' && afterText.substr(0, 2) !== '\\n\\n') {\n        if (afterText.substr(0, 1) !== '\\n') {\n          text += '\\n';\n        }\n\n        text += '\\n';\n      }\n    }\n\n    this.insertText(text, true, selection);\n  }\n  /**\n   * Insert a placeholder, and replace it when the Promise resolved\n   * @param placeholder\n   * @param wait\n   */\n  ;\n\n  _proto.insertPlaceholder = function insertPlaceholder(placeholder, wait) {\n    var _this7 = this;\n\n    this.insertText(placeholder, true);\n    wait.then(function (str) {\n      var text = _this7.getMdValue().replace(placeholder, str);\n\n      _this7.setText(text);\n    });\n  }\n  /**\n   * Insert text\n   * @param {string} value The text will be insert\n   * @param {boolean} replaceSelected Replace selected text\n   * @param {Selection} newSelection New selection\n   */\n  ;\n\n  _proto.insertText = function insertText(value, replaceSelected, newSelection) {\n    if (value === void 0) {\n      value = '';\n    }\n\n    if (replaceSelected === void 0) {\n      replaceSelected = false;\n    }\n\n    var text = this.state.text;\n    var selection = this.getSelection();\n    var beforeContent = text.slice(0, selection.start);\n    var afterContent = text.slice(replaceSelected ? selection.end : selection.start, text.length);\n    this.setText(beforeContent + value + afterContent, undefined, newSelection ? {\n      start: newSelection.start + beforeContent.length,\n      end: newSelection.end + beforeContent.length\n    } : {\n      start: selection.start,\n      end: selection.start\n    });\n  }\n  /**\n   * Set text, and trigger onChange event\n   * @param {string} value\n   * @param {any} event\n   */\n  ;\n\n  _proto.setText = function setText(value, event, newSelection) {\n    var _this8 = this;\n\n    if (value === void 0) {\n      value = '';\n    }\n\n    var _this$config$onChange = this.config.onChangeTrigger,\n        onChangeTrigger = _this$config$onChange === void 0 ? 'both' : _this$config$onChange;\n    var text = value.replace(/↵/g, '\\n');\n\n    if (this.state.text === value) {\n      return;\n    }\n\n    this.setState({\n      text: text\n    });\n\n    if (this.props.onChange && (onChangeTrigger === 'both' || onChangeTrigger === 'beforeRender')) {\n      this.props.onChange({\n        text: text,\n        html: this.getHtmlValue()\n      }, event);\n    }\n\n    this.emitter.emit(this.emitter.EVENT_CHANGE, value, event, typeof event === 'undefined');\n\n    if (newSelection) {\n      setTimeout(function () {\n        return _this8.setSelection(newSelection);\n      });\n    }\n\n    if (!this.hasContentChanged) {\n      this.hasContentChanged = true;\n    }\n\n    var rendering = this.renderHTML(text);\n\n    if (onChangeTrigger === 'both' || onChangeTrigger === 'afterRender') {\n      rendering.then(function () {\n        if (_this8.props.onChange) {\n          _this8.props.onChange({\n            text: _this8.state.text,\n            html: _this8.getHtmlValue()\n          }, event);\n        }\n      });\n    }\n  }\n  /**\n   * Get text value\n   * @return {string}\n   */\n  ;\n\n  _proto.getMdValue = function getMdValue() {\n    return this.state.text;\n  }\n  /**\n   * Get rendered html\n   * @returns {string}\n   */\n  ;\n\n  _proto.getHtmlValue = function getHtmlValue() {\n    if (typeof this.state.html === 'string') {\n      return this.state.html;\n    }\n\n    if (this.nodeMdPreview.current) {\n      return this.nodeMdPreview.current.getHtml();\n    }\n\n    return '';\n  }\n  /**\n   * Listen keyboard events\n   */\n  ;\n\n  /**\n   * Listen keyboard events\n   * @param {KeyboardEventListener} data\n   */\n  _proto.onKeyboard = function onKeyboard(data) {\n    var _this9 = this;\n\n    if (Array.isArray(data)) {\n      data.forEach(function (it) {\n        return _this9.onKeyboard(it);\n      });\n      return;\n    }\n\n    if (!this.keyboardListeners.includes(data)) {\n      this.keyboardListeners.push(data);\n    }\n  }\n  /**\n   * Unlisten keyboard events\n   * @param {KeyboardEventListener} data\n   */\n  ;\n\n  _proto.offKeyboard = function offKeyboard(data) {\n    var _this10 = this;\n\n    if (Array.isArray(data)) {\n      data.forEach(function (it) {\n        return _this10.offKeyboard(it);\n      });\n      return;\n    }\n\n    var index = this.keyboardListeners.indexOf(data);\n\n    if (index >= 0) {\n      this.keyboardListeners.splice(index, 1);\n    }\n  };\n\n  _proto.handleKeyDown = function handleKeyDown(e) {\n    // 遍历监听数组，找找有没有被监听\n    for (var _iterator3 = _createForOfIteratorHelperLoose(this.keyboardListeners), _step3; !(_step3 = _iterator3()).done;) {\n      var it = _step3.value;\n\n      if (isKeyMatch(e, it)) {\n        e.preventDefault();\n        it.callback(e);\n        return;\n      }\n    } // 如果没有，触发默认事件\n\n\n    this.emitter.emit(this.emitter.EVENT_KEY_DOWN, e);\n  };\n\n  _proto.getEventType = function getEventType(event) {\n    switch (event) {\n      case 'change':\n        return this.emitter.EVENT_CHANGE;\n\n      case 'fullscreen':\n        return this.emitter.EVENT_FULL_SCREEN;\n\n      case 'viewchange':\n        return this.emitter.EVENT_VIEW_CHANGE;\n\n      case 'keydown':\n        return this.emitter.EVENT_KEY_DOWN;\n\n      case 'blur':\n        return this.emitter.EVENT_BLUR;\n\n      case 'focus':\n        return this.emitter.EVENT_FOCUS;\n\n      case 'scroll':\n        return this.emitter.EVENT_SCROLL;\n    }\n  }\n  /**\n   * Listen events\n   * @param {EditorEvent} event Event type\n   * @param {any} cb Callback\n   */\n  ;\n\n  _proto.on = function on(event, cb) {\n    var eventType = this.getEventType(event);\n\n    if (eventType) {\n      this.emitter.on(eventType, cb);\n    }\n  }\n  /**\n   * Unlisten events\n   * @param {EditorEvent} event Event type\n   * @param {any} cb Callback\n   */\n  ;\n\n  _proto.off = function off(event, cb) {\n    var eventType = this.getEventType(event);\n\n    if (eventType) {\n      this.emitter.off(eventType, cb);\n    }\n  }\n  /**\n   * Set view property\n   * Can show or hide: editor, preview, menu\n   * @param {object} to\n   */\n  ;\n\n  _proto.setView = function setView(to) {\n    var _this11 = this;\n\n    var newView = _extends({}, this.state.view, to);\n\n    this.setState({\n      view: newView\n    }, function () {\n      _this11.emitter.emit(_this11.emitter.EVENT_VIEW_CHANGE, newView);\n    });\n  }\n  /**\n   * Get view property\n   * @return {object}\n   */\n  ;\n\n  _proto.getView = function getView() {\n    return _extends({}, this.state.view);\n  }\n  /**\n   * Enter or exit full screen\n   * @param {boolean} enable\n   */\n  ;\n\n  _proto.fullScreen = function fullScreen(enable) {\n    var _this12 = this;\n\n    if (this.state.fullScreen !== enable) {\n      this.setState({\n        fullScreen: enable\n      }, function () {\n        _this12.emitter.emit(_this12.emitter.EVENT_FULL_SCREEN, enable);\n      });\n    }\n  }\n  /**\n   * Is full screen\n   * @return {boolean}\n   */\n  ;\n\n  _proto.isFullScreen = function isFullScreen() {\n    return this.state.fullScreen;\n  };\n\n  _proto.uploadWithDataTransfer = function uploadWithDataTransfer(items) {\n    var _this13 = this;\n\n    var onImageUpload = this.config.onImageUpload;\n\n    if (!onImageUpload) {\n      return;\n    }\n\n    var queue = [];\n    Array.prototype.forEach.call(items, function (it) {\n      if (it.kind === 'file' && it.type.includes('image')) {\n        var file = it.getAsFile();\n\n        if (file) {\n          var placeholder = getUploadPlaceholder(file, onImageUpload);\n          queue.push(Promise.resolve(placeholder.placeholder));\n          placeholder.uploaded.then(function (str) {\n            var text = _this13.getMdValue().replace(placeholder.placeholder, str);\n\n            var offset = str.length - placeholder.placeholder.length; // 计算出替换后的光标位置\n\n            var selection = _this13.getSelection();\n\n            _this13.setText(text, undefined, {\n              start: selection.start + offset,\n              end: selection.start + offset\n            });\n          });\n        }\n      } else if (it.kind === 'string' && it.type === 'text/plain') {\n        queue.push(new Promise(function (resolve) {\n          return it.getAsString(resolve);\n        }));\n      }\n    });\n    Promise.all(queue).then(function (res) {\n      var text = res.join('');\n\n      var selection = _this13.getSelection();\n\n      _this13.insertText(text, true, {\n        start: selection.start === selection.end ? text.length : 0,\n        end: text.length\n      });\n    });\n  };\n\n  _proto.render = function render() {\n    var _this14 = this;\n\n    var showHideMenu = this.config.canView && this.config.canView.hideMenu && !this.config.canView.menu;\n    var _this$state = this.state,\n        view = _this$state.view,\n        fullScreen = _this$state.fullScreen;\n\n    var getPluginAt = function getPluginAt(at) {\n      return _this14.state.plugins[at] || [];\n    };\n\n    var isShowMenu = !!view.menu;\n    var id = this.props.id;\n    var editorId = id ? id + \"_md\" : undefined;\n    var previewerId = id ? id + \"_html\" : undefined;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      id: id,\n      className: \"rc-md-editor \" + (fullScreen ? 'full' : ''),\n      style: this.props.style,\n      onKeyDown: this.handleKeyDown,\n      onDrop: this.handleDrop\n    }, /*#__PURE__*/React.createElement(NavigationBar, {\n      visible: isShowMenu,\n      left: getPluginAt('left'),\n      right: getPluginAt('right')\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"editor-container\"\n    }, showHideMenu && /*#__PURE__*/React.createElement(ToolBar, null, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"button button-type-menu\",\n      title: isShowMenu ? 'hidden menu' : 'show menu',\n      onClick: this.handleToggleMenu\n    }, /*#__PURE__*/React.createElement(Icon, {\n      type: \"expand-\" + (isShowMenu ? 'less' : 'more')\n    }))), /*#__PURE__*/React.createElement(\"section\", {\n      className: \"section sec-md \" + (view.md ? 'visible' : 'in-visible')\n    }, /*#__PURE__*/React.createElement(\"textarea\", {\n      id: editorId,\n      ref: this.nodeMdText,\n      name: this.props.name || 'textarea',\n      autoFocus: this.props.autoFocus,\n      placeholder: this.props.placeholder,\n      readOnly: this.props.readOnly,\n      value: this.state.text,\n      className: \"section-container input \" + (this.config.markdownClass || ''),\n      wrap: \"hard\",\n      onChange: this.handleChange,\n      onScroll: this.handleInputScroll,\n      onMouseOver: function onMouseOver() {\n        return _this14.shouldSyncScroll = 'md';\n      },\n      onKeyDown: this.handleEditorKeyDown,\n      onPaste: this.handlePaste,\n      onFocus: this.handleFocus,\n      onBlur: this.handleBlur\n    })), /*#__PURE__*/React.createElement(\"section\", {\n      className: \"section sec-html \" + (view.html ? 'visible' : 'in-visible')\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      id: previewerId,\n      className: \"section-container html-wrap\",\n      ref: this.nodeMdPreviewWrapper,\n      onMouseOver: function onMouseOver() {\n        return _this14.shouldSyncScroll = 'html';\n      },\n      onScroll: this.handlePreviewScroll\n    }, /*#__PURE__*/React.createElement(HtmlRender, {\n      html: this.state.html,\n      className: this.config.htmlClass,\n      ref: this.nodeMdPreview\n    })))));\n  };\n\n  return Editor;\n}(React.Component);\n\nEditor.plugins = [];\nEditor.addLocale = i18n.add.bind(i18n);\nEditor.useLocale = i18n.setCurrent.bind(i18n);\nEditor.getLocale = i18n.getCurrent.bind(i18n);\nexport default Editor;"]},"metadata":{},"sourceType":"module"}